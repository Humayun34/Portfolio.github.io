var EditOperations;!function(e){!function(t){class i extends e.BaseOperation{constructor(e,t,i,n,s,a,r,l,u,h,p){super(e,t,i,n),this.handlePercentageInputChange=e=>{let t=Utils.HtmlUtils.isInputChecked(e.target),i=t?this.percentageResizeDivSelector:this.pixelResizeDivSelector,n=i===this.percentageResizeDivSelector?this.pixelResizeDivSelector:this.percentageResizeDivSelector;Utils.HtmlUtils.displayElementDefault(n,!1),Utils.HtmlUtils.displayElementDefault(i,!0),this.validateInputs(t)},this.handleResizePercentageInputChange=()=>{let e=this.validatePercentageInput();super.setOperationTriggerEnabled(e)},this.percentageInput=document.querySelector(s),this.pixelResizeDivSelector=a,this.percentageResizeDivSelector=r,this.widthInput=document.querySelector(l),this.heightInput=document.querySelector(u),this.fixedRatioInput=document.querySelector(h),this.resizePercentageInput=document.querySelector(p)}init(){super.init(),Utils.BrowserUtils.onDocumentReady((()=>{this.initInputs(),this.validateInputs(Utils.HtmlUtils.isInputChecked(this.percentageInput));let e=e=>{this.handleInputChange(e.target)};this.widthInput.addEventListener("input",e),this.heightInput.addEventListener("input",e),this.resizePercentageInput.addEventListener("input",this.handleResizePercentageInputChange),this.setHtmlInputsEnabled(this.percentageInput,!0),this.percentageInput.addEventListener("change",this.handlePercentageInputChange)}))}initInputs(){let t=this.getInputValue(document.querySelector(e.BaseOperation.WidthHdnSelector)).toString(),i=this.getInputValue(document.querySelector(e.BaseOperation.HeightHdnSelector)).toString();this.widthInput.value!==t&&(this.widthInput.value=t),this.heightInput.value!==i&&(this.heightInput.value=i)}validateInputs(e){let t=e?this.validatePercentageInput():this.validatePixelInputs();super.setOperationTriggerEnabled(t)}validatePercentageInput(){let t=this.resizePercentageInput.value;if(!Utils.StringUtils.isNumber(t))return!1;let i=parseInt(t);if(i<1)this.resizePercentageInput.value="1";else{let t=(i+0)/100,n=this.getInputValue(document.querySelector(e.BaseOperation.MaxSizeHdnSelector)),s=(n+0)/this.getInputValue(document.querySelector(e.BaseOperation.WidthHdnSelector)),a=(n+0)/this.getInputValue(document.querySelector(e.BaseOperation.HeightHdnSelector)),r=Math.min(s,a);if(t>r){let e=Math.floor(100*r);this.resizePercentageInput.value=e.toString()}}return!0}validatePixelInputs(){return!!this.validatePixelInput(this.widthInput)&&this.validatePixelInput(this.heightInput)}validatePixelInput(t){let i=t.value;if(!Utils.StringUtils.isNumber(i))return!1;let n=parseInt(i),s=parseInt(t.getAttribute("min")),a=this.getInputValue(document.querySelector(e.BaseOperation.MaxSizeHdnSelector));return this.valueInsideInterval(n,s,a)}setControlsEnabled(e){super.setControlsEnabled(e);let t=!e;this.setHtmlInputsEnabled(this.percentageInput,t),this.setHtmlInputsEnabled(this.widthInput,t),this.setHtmlInputsEnabled(this.heightInput,t),this.setHtmlInputsEnabled(this.resizePercentageInput,t)}handleInputChange(t){let i=t.value;if(!Utils.StringUtils.isNumber(i))return void super.setOperationTriggerEnabled(!1);let n=parseInt(i),s=parseInt(t.getAttribute("min")),a=this.getInputValue(document.querySelector(e.BaseOperation.MaxSizeHdnSelector)),r=t.id===this.widthInput.id,l=r?this.heightInput:this.widthInput;if(Utils.HtmlUtils.isInputChecked(this.fixedRatioInput)){let i,u,h=parseFloat(document.querySelector(e.BaseOperation.WidthToHeightHdnSelector).value),p=(e,t)=>this.calcWidth(e,t),o=(e,t)=>this.calcHeight(e,t);r?(i=p,u=o):(i=o,u=p),this.handleResizeWithRatio(t,n,l,s,a,h,i,u),super.setOperationTriggerEnabled(!0)}else{this.handleResizeWithoutRatio(t,n,s,a);let e=Utils.StringUtils.isNumber(l.value);super.setOperationTriggerEnabled(e)}}handleResizeWithoutRatio(e,t,i,n){if(!this.valueInsideInterval(t,i,n)){let s=this.getClosestValue(t,i,n);e.value=s.toString()}}handleResizeWithRatio(e,t,i,n,s,a,r,l){this.valueInsideInterval(t,n,s)||(t=this.getClosestValue(t,n,s));let u=l(t,a);this.valueInsideInterval(u,n,s,!1)||(u=this.getClosestValue(u,n,s),t=r(u,a)),e.value=t.toString(),i.value=u.toString()}valueInsideInterval(e,t,i,n=!0){return n?e>=t&&e<=i:e>t&&e<i}getClosestValue(e,t,i){return Math.abs(e-t)<Math.abs(e-i)?t:i}calcWidth(e,t){return Math.round(e*t)}calcHeight(e,t){return Math.round(e/t)}initOperation(){Utils.HtmlUtils.isInputChecked(this.percentageInput)&&this.validatePercentageInput()}validateData(t){let i,n=t.width,s=t.height;if(n&&s){let t=this.getInputValue(document.querySelector(e.BaseOperation.WidthHdnSelector)),a=this.getInputValue(document.querySelector(e.BaseOperation.HeightHdnSelector));if(!(n<=t&&s<=a)){let t=this.getInputValue(document.querySelector(e.BaseOperation.MaxResolutionHdnSelector)),a=n*s;if(a>t){let e=Math.ceil(100*(1-(t+0)/a));i=Utils.TranslateService.translate("Edit_Error_ResizeSizeTooLarge",e)}}}return i}gatherOperationParams(){let i,n;if(Utils.HtmlUtils.isInputChecked(this.percentageInput)){let s=this.getInputValue(document.querySelector(e.BaseOperation.WidthHdnSelector)),a=this.getInputValue(document.querySelector(e.BaseOperation.HeightHdnSelector)),r=this.getInputValue(this.resizePercentageInput);return i=this.calcSizeByPercentage(s,r),n=this.calcSizeByPercentage(a,r),new t.ResizeOperationParams(i,n,r)}return i=this.getInputValue(this.widthInput),n=this.getInputValue(this.heightInput),new t.ResizeOperationParams(i,n,void 0)}calcSizeByPercentage(e,t){let i=Math.floor((e*t+0)/100);return Math.max(1,i)}getInputValue(e){return parseInt(e.value)}handleImageOperationCompleteEvent(e,t){super.handleImageOperationCompleteEvent(e,t),t&&(this.widthInput.value=t.currentImageWidth.toString(),this.heightInput.value=t.currentImageHeight.toString(),this.setOperationTriggerEnabled(!0))}}if(t.ResizeOperation=i,editPage.hasImage){let t=new e.Resize.ResizeOperation("Resize","#resizeImageBtn","#resizeStatus","/api/ResizeImage","#percentageCheckbox","#pixelResizeDiv","#percentageResizeDiv","#resizeWidthInput","#resizeHeightInput","#resizeAspectRatioCheckbox","#resizePercentageInput");t.init(),editPage.registerOperation(t)}}(e.Resize||(e.Resize={}))}(EditOperations||(EditOperations={})),function(e){(e.Resize||(e.Resize={})).ResizeOperationParams=class{constructor(e,t,i){this.width=e,this.height=t,this.percentage=i}}}(EditOperations||(EditOperations={}));var ResizeFallback={};